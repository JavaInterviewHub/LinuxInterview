## 备份压缩

* [1.打包跟压缩的区别：](#1打包跟压缩的区别)
* [2.Linux主要压缩方式](#2linux主要压缩方式)
* [3.文件后缀名 .tar.gz 是用哪种方式压缩的](#3文件后缀名-targz-是用哪种方式压缩的)
* [4..文件后缀名.tar.bz2是用哪种方式压缩的](#4文件后缀名tarbz2是用哪种方式压缩的)
* [5.压缩多个文件](#5压缩多个文件)
* [6.zip格式](#6zip格式)
* [7.zip压缩文件](#7zip压缩文件)
* [8.将所有 .jpg 的文件打成一个名为 all.tar 的包](#8将所有-jpg-的文件打成一个名为-alltar-的包)
* [9.将所有 .gif 的文件增加到 all.tar 的包里面去](#9将所有-gif-的文件增加到-alltar-的包里面去)
* [10.将目录里所有jpg文件打包成 tar.jpg](#10将目录里所有jpg文件打包成-tarjpg)
* [11. gzip 中 将压缩数据输出到标准输出中，并保留源文件的选项是](#11-gzip-中-将压缩数据输出到标准输出中并保留源文件的选项是)
* [12.如果一个系统没有备份策略，请写出一个较为全面合理的备份方案](#12如果一个系统没有备份策略请写出一个较为全面合理的备份方案)
* [13.完全备份](#13完全备份)
* [14.累计增量备份](#14累计增量备份)
* [15.差异增量备份](#15差异增量备份)
* [16.如果网站服务器每天产生的日志数量较大，请问如何备份？](#16如果网站服务器每天产生的日志数量较大请问如何备份)
* [参考链接](#参考链接)

#### 1.打包跟压缩的区别：

打包是指将多个文件或者目录放在一起，形成一个总的包，这样便于保存和传输，但是大小是没有变化的，压缩是指将一个或者多个大文件或者目录通过压缩算法使文件的体积变小以达到压缩的目的，可以节省存储空间，在压缩的时候通常是先打包再压缩；



#### 2.Linux主要压缩方式

linux主要有三种压缩方式：
1.gzip：是公认的压缩这速度最快，压缩大文件的时候与其他的压缩方式相比更加明显，历史最久，应用最广泛的压缩方式
2.bzip：压缩形成的文件小，但是可用性不如gzip
3.xz：是最新的压缩方式，可以自动提供最佳的压缩率

#### 3.文件后缀名 .tar.gz 是用哪种方式压缩的

gzip

#### 4..文件后缀名.tar.bz2是用哪种方式压缩的

用于bzip2压缩方式

#### 5.压缩多个文件

tar zcvf FileName.tar.gz DirName1 DirName2 DirName3

#### 6.zip格式

zip是Windows中最常见的压缩格式，Linux也可以正确识别，zip命令所在目录为/usr/bin/zip，所有用户可以执行，用来压缩文件或目录

#### 7.zip压缩文件

```linux
# 压缩文件
zip -r test.zip file
```

#### 8.将所有 .jpg 的文件打成一个名为 all.tar 的包

```linux
# tar -cf all.tar *.jpg
```

-c 是表示产生新的包，-f 指定包的文件名。

#### 9.将所有 .gif 的文件增加到 all.tar 的包里面去

```linux
# tar -rf all.tar *.gif
```

-r 是表示增加文件的意思。

####  10.将目录里所有jpg文件打包成 tar.jpg 

```linux
tar –cvf jpg.tar *.jpg
```



#### 11. gzip 中 将压缩数据输出到标准输出中，并保留源文件的选项是

-c

#### 12.如果一个系统没有备份策略，请写出一个较为全面合理的备份方案

需要备份的内容：
1.重要的系统目录

/etc/
/home/
/root/
/var/spool/mail/
/var/spool/cron/
/var/spool/at/
2.mysql数据库

RAM包安装的mysql：/var/lib/mysql/
源码安装的mysql：/usr/local/mysql/data/
3.apache服务

网站内容：/var/www/html/ /usr/local/apache2/htdocs/
配置文件：/etc/httpd/conf/httpd.conf /usr/local/apache2/conf/httpd.conf
日志文件：/var/log/httpd/ /usr/local/apache2/logs/
4.如果有其他服务，也需要备份重要数据
备份策略：
1.完整备份：实现命令：cp，tar，dump，xfsdump
2.增量备份：每次备份以前一次备份作为参照
实现命令：centos6：dump工具；centos7：xfsdump工具
3.差异备份：每次备份以第一次备份作为参照
实现命令：centos6：dump工具
centos7：xfsdump工具

备份频率：

实时备份：如MySQL主从同步
定时备份：如每天，每周备份，一般通过“脚本+定时任务”实现
备份存储位置：
基本原则：不要把鸡蛋放在同一个篮子中

本地备份
异地备份
常见服务器的备份方案：
1.每日备份的数据（异地备份）
mysql数据库（主从备份之外，增量备份一次）
2.每周备份的数据（异地备份）
mysql数据库（完整备份）
重要的系统数据
网页数据
其他服务相关数据

#### 13.完全备份

完全备份是指把所有需要备份的数据全部备份。当然，完全备份可以备份整块硬盘、整个分区或某个具体的目录。对于 Linux 操作系统来说，完全备份指的就是将根目录下的所有文件进行备份。

完全备份的好处是，所有数据都进行了备份，系统中任何数据丢失都能恢复，且恢复效率较高。如果完全备份备份的是整块硬盘，那么甚至不需要数据恢复，只要把备份硬盘安装上，服务器就会恢复正常。

完全备份的缺点也很明显，那就是需要备份的数据量较大，备份时间较长，备份了很多无用数据，占用的空间较大，所以完全备份不可能每天执行。

我们一般会对关键服务器进行整盘完全备份，如果出现问题，则可以很快地使用备份硬盘进行替换，从而减少损失。我们甚至会对关键服务器搭设一台一模一样的服务器，这样只要远程几个命令（或使用 Shell 脚本自动检测，自动进行服务器替换），备份服务器就会接替原本的服务器，使故障响应时间大大缩短。

#### 14.累计增量备份

在一个数据量很大的业务应用中，每天对 Linux 系统进行完全备份是不现实的，这就需要用到增量备份策略。

累计增量备份是指先进行一次完全备份，服务器运行一段时间之后，比较当前系统和完全备份的备份数据之间的差异，只备份有差异的数据。服务器继续运行，再经过一段时间，进行第二次增量备份。在进行第二次增量备份时，当前系统和第一次增量备份的数据进行比较，也是只备份有差异的数据。第三次增量备份是和第二次增量备份的数据进行比较，以此类推。

因此，累计增量备份就是只备份每天增加或者变化的数据，而不备份系统中没有变动的数据。我们画一张示意图，如图 1 所示。


![累计增量备份](http://c.biancheng.net/uploads/allimg/181029/2-1Q0291641164c.jpg)


假设我们在第一天进行一次完全备份。第二天增量备份时，只会备份第二天和第一天之间的差异数据，但是第二天的总备份数据是完全备份加第一次增量备份的数据。第三天增量备份时，只会备份第三天和第二天之间的差异数据，但是第三天的总备份数据是完全备份加第一次增量备份的数据，再加第二次增量备份的数据。当然，第四天增量备份时，只会备份第四天和第三天的差异数据，但是第四天的总备份数据是完全备份加第一次增量备份的数据，加第二次增量备份的数据，再加第三次增量备份的数据。

采用累计增量备份的好处是，每次备份需要备份的数据较少，耗时较短，占用的空间较小；坏处是数据恢复比较麻烦，如果是图 1 的例子，那么当进行数据恢复时，就要先恢复完全备份的数据，再依次恢复第一次增量备份的数据、第二次增量备份的数据和第三次增量备份的数据，最终才能恢复所有的数据。

#### 15.差异增量备份

差异增量备份（后续简称差异备份）也要先进行一次完全备份，但是和累计增量备份不同的是，每次差异备份都备份和原始的完全备份不同的数据。也就是说，差异备份每次备份的参照物都是原始的完全备份，而不是上一次的差异备份。我们也画一张示意图，如图 2 所示。

![差异增量备份](http://c.biancheng.net/uploads/allimg/181029/2-1Q02916415T37.jpg)
假设我们在第一天也进行一次完全备份。第二天差异备份时，会备份第二天和第一天之间的差异数据，而第二天的备份数据是完全备份加第一次差异备份的数据。第三天进行差异备份时，仍和第一天的原始数据进行对比，把第二天和第三天所有的数据都备份在第二次差异备份中，第三天的备份数据是完全备份加第二次差异备份的数据。第四天进行差异备份时，仍和第一天的原始数据进行对比，把第二天、第三天和第四天所有的不同数据都备份到第三次差异备份中，第四天的备份数据是完全备份加第三次差异备份的数据。

相比较而言，差异备份既不像完全备份一样把所有数据都进行备份，也不像增量备份在进行数据恢复时那么麻烦，只要先恢复完全备份的数据，再恢复差异备份的数据即可。不过，随着时间的增加，和完全备份相比，变动的数据越来越多，那么差异备份也可能会变得数据量庞大、备份速度缓慢、占用空间较大。

一个比较的备份策略是，对于数据量不大，并且每天数据量增加不多的系统，优先选择完全备份；对于数据量巨大，每天新增数据也很多的系统，视情况选择差异备份或者增量备份。

#### 16.如果网站服务器每天产生的日志数量较大，请问如何备份？

- 系统日志管理工具：logratate（日志切割，日志轮替）
- apache服务配置文件自带日志切割功能，但是需要通过脚本进行轮替

#### 参考链接

https://blog.csdn.net/weixin_44901564/article/details/99682926

https://blog.csdn.net/u012060395/article/details/104541101

https://blog.csdn.net/rubulai/article/details/90814639